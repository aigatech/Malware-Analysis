from utils.bin_processing import process_binaries, analyze_and_save_binary
from utils.log_utils import setup_logging
from utils.vis_utils import init_vis

import os
import glob
from tqdm import tqdm
import click

@click.command()
@click.option('--data_dir', default='data', help='Directory where the neutralized binaries are stored')
@click.option('--vis_mode', default=2, type=int, help='Visualization mode: 0 = visualize in window, 1 = save as HTML docs, 2 = save graphs w/o visualizing as edgelists')
@click.option('--job_id', default=0, type=int, help='Job ID for logging')
def main(data_dir, vis_mode, job_id):
    log_file = setup_logging(job_id)
    # init_vis(vis_mode)

    for infile in tqdm(glob.glob(os.path.join(data_dir, '*')), desc="Processing binaries"):
        analyze_and_save_binary(infile, vis_mode, log_file)

if __name__ == '__main__':
    main()
